$schema: https://json-schema.org/draft/2020-12/schema#
type: object
title: Room features
properties:
    formatting:
        type: object
        description: |
            Capabilities for formatting messages.

            The unsupported/0 capability level means the tag/attribute is ignored and uses normal HTML fallback rules
            (i.e. the children will be rendered, but attributes will not). Support level 1 means the tag is handled, but
            the output is only approximated (e.g. prepending `>` for blockquotes).
        propertyNames:
            $ref: "#/$defs/FormattingFeature"
            title: feature
        additionalProperties:
            $ref: "#/$defs/CapabilitySupportLevel"
        examples:
        - bold: 2
          italic: 2
          code_block: 2
          code_block.syntax_highlighting: -1
          spoiler: 2
          spoiler.reason: 1
    file:
        type: object
        description: |
            Capabilities for sending messages with file attachments.
            If a message type is not listed, it should be treated as support level -2 (unsupported and will be rejected).
        propertyNames:
            $ref: "#/$defs/CapabilityMessageType"
        additionalProperties:
            type: object
            title: FileFeatures
            properties:
                mime_types:
                    type: object
                    description: |
                        A map of mime types and their support levels. If a mime type doesn't match any of the patterns,
                        it should be treated as support level -2 (unsupported and will be rejected).
                    propertyNames:
                        type: string
                        format: mimetype
                        title: mimetype
                        description: |
                            The MIME type or pattern for this support level.

                            This can either be a raw mime type (possibly with a `codecs` parameter),
                            a pattern matching any mime type prefix (e.g. `image/*`), or any mime type (`*/*`).
                            Wildcards aren't allowed anywhere else.
                        examples:
                        - audio/ogg; codecs=opus
                        - video/webm; codecs="vp8, vorbis"
                        - image/png
                        - image/*
                        - "*/*"
                    additionalProperties:
                        $ref: "#/$defs/CapabilitySupportLevel"
                captions:
                    $ref: "#/$defs/CapabilitySupportLevel"
                    description: Can this message type have captions?
                max_caption_length:
                    type: number
                    minimum: 0
                max_size:
                    type: number
                    format: bytes
                    minimum: 0
                max_width:
                    type: number
                    format: pixels
                    minimum: 0
                max_height:
                    type: number
                    format: pixels
                    minimum: 0
                max_duration:
                    $ref: "#/$defs/DurationSeconds"
        examples:
        -   m.image:
                mime_types:
                    image/png: 2
                    image/jpeg: 2
                    image/gif: 2
                    image/webp: 1
                captions: 2
                max_caption_length: 1000
                max_size: 8000000
                max_width: 4096
                max_height: 4096
            m.video:
                mime_types:
                    video/mp4: 2
                    video/webm: 2
                captions: 2
                max_caption_length: 1000
                max_size: 64000000
                max_width: 4096
                max_height: 4096
                max_duration: 600
            m.file:
                mime_types:
                    "*/*": 2
                captions: 2
                max_size: 64000000
            org.matrix.msc3245.voice:
                mime_types:
                    "audio/ogg; codecs=opus": 2
                captions: -1
                max_size: 8000000
                max_duration: 600
    location_message:
        $ref: "#/$defs/CapabilitySupportLevel"
        description: Whether sending location messages is supported.
    poll:
        $ref: "#/$defs/CapabilitySupportLevel"
        description: Whether creating polls is supported.
    thread:
        $ref: "#/$defs/CapabilitySupportLevel"
        description: Whether replying in a thread is supported.
    reply:
        $ref: "#/$defs/CapabilitySupportLevel"
        description: Whether replying to a specific message is supported.
    edit:
        $ref: "#/$defs/CapabilitySupportLevel"
    edit_max_age:
        $ref: "#/$defs/DurationSeconds"
        description: The maximum age of messages that can be edited. If zero or omitted, messages of any age can be edited.
        examples:
        - 900
        - 86400
    edit_max_count:
        type: number
        minimum: 0
        description: The maximum number of times that a single message can be edited. If zero or omitted, there is no limit.
        examples:
        - 5
    delete:
        $ref: "#/$defs/CapabilitySupportLevel"
        description: Whether deleting messages for everyone is supported.
    delete_for_me:
        type: boolean
        description: Whether deleting messages just for the user is supported.
    delete_max_age:
        $ref: "#/$defs/DurationSeconds"
        description: |
            The maximum age of messages that can be deleted for everyone.
            If zero or omitted, messages of any age can be deleted.
            "Delete for me" never has age limits.
        examples:
        - 900
        - 86400
    reaction:
        $ref: "#/$defs/CapabilitySupportLevel"
        description: Whether reacting to messages is supported.
    reaction_count:
        type: integer
        description: |
            The maximum number of reactions that can be added to a single message.
            If unset, unlimited reactions are allowed.
        examples:
        - 1
        - 3
    allowed_reactions:
        type: array
        description: |
            A list of emojis that are allowed for reactions. Must have variation selector 16 if applicable.
            If omitted, any unicode emoji is allowed.
        items:
            type: string
            title: emoji
            examples:
            - "üëç"
            - "‚ù§Ô∏è"
    custom_emoji_reactions:
        type: boolean
        description: Whether custom reactions are supported.
    read_receipts:
        type: boolean
    typing_notifications:
        type: boolean
$defs:
    DurationSeconds:
        type: number
        format: seconds
        minimum: 0
    CapabilityMessageType:
        type: string
        description: |
            A Matrix message type or a pseudo-type that is somehow distinct.

            * `m.image`, `m.video`, `m.audio` and `m.file` are standard Matrix msgtypes.
            * `m.sticker` is also a standard event, but it doesn't have a msgtype
               and uses `m.sticker` as the event type instead of `m.room.message`.
            * `fi.mau.gif` is either an `m.image` message with mime type `image/gif`
               or an `m.video` message with `"fi.mau.gif": true` inside `info`.
            * `org.matrix.msc3245.voice` is an `m.audio` message with
              `"org.matrix.msc3245.voice": {}` in the content.
        enum:
        - m.image
        - m.video
        - m.audio
        - m.file
        - m.sticker
        - fi.mau.gif
        - org.matrix.msc3245.voice
    FormattingFeature:
        type: string
        description: |
            A formatting feature that can be supported.

            Each feature can be directly mapped to specific HTML tags or attributes,
            except `at_room_mention` which is only a flag in `m.mentions`.
        enum:
        - bold
        - italic
        - underline
        - strikethrough
        - inline_code
        - code_block
        - code_block.syntax_highlighting
        - blockquote
        - inline_link
        - user_link
        - room_link
        - event_link
        - at_room_mention
        - unordered_list
        - ordered_list
        - ordered_list.start
        - ordered_list.jump_value
        - custom_emoji
        - spoiler
        - spoiler.reason
        - color.foreground
        - color.background
        - horizontal_line
        - headers
        - superscript
        - subscript
        - math
        - details_summary
        - table
    CapabilitySupportLevel:
        type: integer
        enum: [ -2, 1, 0, 1, 2 ]
        enumDescriptions:
        - The feature is unsupported and messages using it will be rejected.
        - The feature is unsupported and has no fallback. The message will go through, but data may be lost.
        - The feature is unsupported, but may have a fallback.
        - The feature is partially supported (e.g. it may be converted to a different format).
        - The feature is fully supported and can be safely used.
        examples: [ 2, 0 ]
